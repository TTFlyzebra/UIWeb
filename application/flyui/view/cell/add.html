<!doctype html>
<html lang="en">
<link rel="stylesheet" type="text/css" href="__RES__/common/css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="__RES__/common/css/bootstrap-theme.css">
<link rel="stylesheet" type="text/css" href="__RES__/common/css/bootstrap-table.css">
<script type="text/javascript" src="__RES__/common/js/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="__RES__/common/js/bootstrap.js"></script>
<script type="text/javascript" src="__RES__/common/js/bootstrap-table.js"></script>
<script type="text/javascript" src="__RES__/common/js/bootstrap-table-zh-CN.min.js"></script>
<script type="text/javascript" src="__RES__/admin/js/flyinput.js"></script>
<body>
<div class="modal-header">
    <h4 class="modal-title">添加控件</h4>
</div>
<ul id="myTab" class="nav nav-tabs">
    <li class="active"><a href="#home" data-toggle="tab">主控件</a></li>
</ul>
<form class="form-horizontal" name="celltypeform" id="celltypeform" method="post" role="form"
      action="{:url('/admin/test')}" enctype="multipart/form-data">
    <div id="myTabContent" class="tab-content">
        <div class="tab-pane fade in active" id="home">
            <div class="modal-body">
                <button type="button"
                        style="width:40px;height:40px;position: absolute;top:10px;right: 10px;font-size: 24px;"
                        onclick="addSub()">+
                </button>
                <div class="form-group">
                    <label class="col-sm-1 control-label">控件类型</label>
                    <div class="col-sm-4">
                        <h4 class="modal-title">
                            <select id="celltypeId" name="celltypeId">
                                {volist name="list1" id="celltype" key="k"}
                                <option value="{$celltype.celltypeId}">{$celltype.celltypeName}</option>
                                {/volist}
                            </select>
                        </h4>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-1 control-label">图&nbsp&nbsp片&nbsp&nbsp一</label>
                    <div class="col-sm-4">
                        <input type="file" accept="image/*" id="imageinput1" name="imagefile">
                        <input type="hidden" id="imageurl1" name="imageurl1" value="">
                    </div>
                    <label class="col-sm-1 control-label">图&nbsp&nbsp片&nbsp&nbsp二</label>
                    <div class="col-sm-4">
                        <input type="file" accept="image/*" id="imageinput2" name="imagefile">
                        <input type="hidden" id="imageurl2" name="imageurl2" value="">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-1 control-label">图片尺寸</label>
                    <div class="col-sm-1">
                        <input id="width" name="width" type="text" class="form-control" value="" placeholder="宽度(像素)">
                    </div>
                    <div class="col-sm-1">
                        <input id="height" name="height" type="text" class="form-control" value="" placeholder="高度(像素)">
                    </div>
                    <div class="col-sm-2"></div>
                    <label class="col-sm-1 control-label">图片尺寸</label>
                    <div class="col-sm-1">
                        <input id="width2" type="text" class="form-control" value="" placeholder="宽度(像素)">
                    </div>
                    <div class="col-sm-1">
                        <input id="height2" type="text" class="form-control" value="" placeholder="高度(像素)">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-1 control-label">文本内容</label>
                    <div class="col-sm-4">
                        <input type="text" class="form-control" name="textTitle" id="textTitle" value=""
                               placeholder="文字显示">
                    </div>
                    <label class="col-sm-1 control-label">文本字体</label>
                    <div class="col-sm-1">
                        <input id="textSize" class="form-control" name="textSize" type="text" value=""
                               placeholder="字体大小">
                    </div>
                    <div class="col-sm-1">
                        <input id="textColor" class="form-control" name="textColor" type="text" value=""
                               placeholder="字体颜色">
                    </div>
                    <div class="col-sm-2">
                        <input id="textFont" class="form-control" name="textFont" type="text" value=""
                               placeholder="字体样式">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-1 control-label">文本位置</label>
                    <div class="col-sm-1">
                        <input id="textLeft" class="form-control" name="textLeft" type="text" value=""
                               placeholder="LEFT">
                    </div>
                    <div class="col-sm-1">
                        <input id="textTop" class="form-control" name="textTop" type="text" value="" placeholder="TOP">
                    </div>
                    <div class="col-sm-1">
                        <input id="textRight" class="form-control" name="textRight" type="text" value=""
                               placeholder="RIGHT">
                    </div>
                    <div class="col-sm-1">
                        <input id="textBottom" class="form-control" name="textBottom" type="text" value=""
                               placeholder="BOTTOM">
                    </div>
                    <div class="col-sm-1">
                        <input id="textAlign" class="form-control" name="textAlign" type="text" value=""
                               placeholder="ALIGN">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-1 control-label">启动事件</label>
                    <div class="col-sm-2">
                        <input id="packName" class="form-control" name="packName" type="text" value="" placeholder="包名">
                    </div>
                    <div class="col-sm-2">
                        <input id="className" class="form-control" name="className" type="text" value=""
                               placeholder="类名">
                    </div>
                    <div class="col-sm-1">
                        <input id="intentFlag" class="form-control" name="intentFlag" type="text" value=""
                               placeholder="Intent Flag">
                    </div>
                    <div class="col-sm-2">
                        <input id="action" class="form-control" name="action" type="text" value="" placeholder="ACTION">
                    </div>
                    <div class="col-sm-2">
                        <input id="flyAction" class="form-control" name="flyAction" type="text" value=""
                               placeholder="自定义">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-1 control-label">备注</label>
                    <div class="col-sm-9">
                            <textarea class="form-control" name="remark" value="" id="remark"
                                      placeholder="备注"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-default" onclick="onCancel()">取消</button>
        <button type="reset" class="btn btn-default">重置</button>
        <button type="button" class="btn btn-primary" onclick="postform()">提交</button>
    </div>
</form>
</body>
</html>

<script type="text/javascript">
    var subcellnum = 1;
    function postform() {
        $.ajax({
            type: "POST",
            url: "{:url('/api/cell')}",
            data: $('#celltypeform').serialize(),
            error: function (request) {
                alert("error code:" + request.readyState);
            },
            success: function (data) {
                var obj = JSON.parse(data);
                if (obj.code === 0) {
                    window.history.back();
                } else {
                    alert(obj.msg);
                }
            }
        });
    }

    function flyinput1(sub) {
        $('#' + sub + 'imageinput1').flyinput({
            url: "{:url('/api/imagefile')}",
            autoup: true,
            showPreview: true,
            width: "100%",
            height: "240px",
            background: "#101010"
        }).bind("success", function (e, data) {
            var retmsg = JSON.parse(data);
            $('#' + sub + 'imageurl1').val(retmsg.data.saveName);
            $('#' + sub + 'width').val(retmsg.data.width);
            $('#' + sub + 'height').val(retmsg.data.height);
        });
    }

    function flyinput2(sub) {
        $('#' + sub + 'imageinput2').flyinput({
            url: "{:url('/api/imagefile')}",
            autoup: true,
            showPreview: true,
            width: "100%",
            height: "240px",
            background: "#101010"
        }).bind("success", function (e, data) {
            var retmsg = JSON.parse(data);
            $('#' + sub + 'imageurl2').val(retmsg.data.saveName);
            $('#' + sub + 'width2').val(retmsg.data.width);
            $('#' + sub + 'height2').val(retmsg.data.height);
        });
    }

    flyinput1('');
    flyinput2('');

    function onCancel() {
        window.history.back();
    }


    function createTabContent(name) {
        var tab = $(" <li ><a href=\"#" + name + "\" data-toggle=\"tab\">子控件</a></li>");
        var tabContent = $('<div class="tab-pane fade" id="' + name + '">\n' +
            '            <div class="modal-body">\n' +
            '            <input type="hidden" name="subcell[]" value="' + name + '">\n' +
            '            <button type="button" style="width:40px;height:40px;position: absolute;top:10px;right: 10px;font-size: 24px;" onclick="addSub()">+</button>' +
            '            <button id="del' + name + '" type="button" style="width:40px;height:40px;position: absolute;top:10px;right: 50px;font-size: 24px;">-</button>' +
            '            <div class="form-group">\n' +
            '            <label class="col-sm-1 control-label">控件类型</label>\n' +
            '            <div class="col-sm-4">\n' +
            '            <h4 class="modal-title">\n' +
            '            <select name="' + name + 'celltypeId">\n' +
            '            {volist name="list1" id="celltype" key="k"}\n' +
            '            <option value="{$celltype.celltypeId}">{$celltype.celltypeName}</option>\n' +
            '        {/volist}\n' +
            '        </select>\n' +
            '        </h4>\n' +
            '        </div>\n' +
            '        </div>\n' +
            '        <div class="form-group">\n' +
            '            <label class="col-sm-1 control-label">图&nbsp&nbsp片&nbsp&nbsp一</label>\n' +
            '            <div class="col-sm-4">\n' +
            '            <input type="file" accept="image/*" id="' + name + 'imageinput1" name="imagefile">\n' +
            '            <input type="hidden" id="' + name + 'imageurl1" name="' + name + 'imageurl1" value="">\n' +
            '            </div>\n' +
            '            <label class="col-sm-1 control-label">图&nbsp&nbsp片&nbsp&nbsp二</label>\n' +
            '            <div class="col-sm-4">\n' +
            '            <input type="file" accept="image/*" id="' + name + 'imageinput2" name="imagefile">\n' +
            '            <input type="hidden" id="' + name + 'imageurl2" name="' + name + 'imageurl2" value="">\n' +
            '            </div>\n' +
            '            </div>\n' +
            '            <div class="form-group">\n' +
            '            <label class="col-sm-1 control-label">图片尺寸</label>\n' +
            '            <div class="col-sm-1">\n' +
            '            <input id="' + name + 'width" name="' + name + 'width" type="text" class="form-control" value="" placeholder="宽度(像素)">\n' +
            '            </div>\n' +
            '            <div class="col-sm-1">\n' +
            '            <input id="' + name + 'height" name="' + name + 'height" type="text" class="form-control" value="" placeholder="高度(像素)">\n' +
            '            </div>\n' +
            '            <div class="col-sm-2"></div>\n' +
            '            <label class="col-sm-1 control-label">图片尺寸</label>\n' +
            '            <div class="col-sm-1">\n' +
            '            <input id="' + name + 'width2" type="text" class="form-control" value="" placeholder="宽度(像素)">\n' +
            '            </div>\n' +
            '            <div class="col-sm-1">\n' +
            '            <input id="' + name + 'height2" type="text" class="form-control" value="" placeholder="高度(像素)">\n' +
            '            </div>\n' +
            '            </div>\n' +
            '            <div class="form-group">\n' +
            '            <label class="col-sm-1 control-label">文本内容</label>\n' +
            '            <div class="col-sm-4">\n' +
            '            <input type="text" class="form-control" name="' + name + 'textTitle" id="' + name + 'textTitle" value=""\n' +
            '            placeholder="文字显示">\n' +
            '                </div>\n' +
            '                <label class="col-sm-1 control-label">文本字体</label>\n' +
            '            <div class="col-sm-1">\n' +
            '            <input id="' + name + 'textSize" class="form-control" name="' + name + 'textSize" type="text" value=""\n' +
            '            placeholder="字体大小">\n' +
            '                </div>\n' +
            '                <div class="col-sm-1">\n' +
            '            <input id="' + name + 'textColor" class="form-control" name="' + name + 'textColor" type="text" value=""\n' +
            '            placeholder="字体颜色">\n' +
            '                </div>\n' +
            '                <div class="col-sm-2">\n' +
            '            <input id="' + name + 'textFont" class="form-control" name="' + name + 'textFont" type="text" value=""\n' +
            '            placeholder="字体样式">\n' +
            '                </div>\n' +
            '                </div>\n' +
            '                <div class="form-group">\n' +
            '            <label class="col-sm-1 control-label">文本位置</label>\n' +
            '            <div class="col-sm-1">\n' +
            '            <input id="' + name + 'textLeft" class="form-control" name="' + name + 'textLeft" type="text" value=""\n' +
            '            placeholder="LEFT">\n' +
            '                </div>\n' +
            '                <div class="col-sm-1">\n' +
            '            <input id="' + name + 'textTop" class="form-control" name="' + name + 'textTop" type="text" value="" placeholder="TOP">\n' +
            '            </div>\n' +
            '            <div class="col-sm-1">\n' +
            '            <input id="' + name + 'textRight" class="form-control" name="' + name + 'textRight" type="text" value=""\n' +
            '            placeholder="RIGHT">\n' +
            '                </div>\n' +
            '                <div class="col-sm-1">\n' +
            '            <input id="' + name + 'textBottom" class="form-control" name="' + name + 'textBottom" type="text" value=""\n' +
            '            placeholder="BOTTOM">\n' +
            '                </div>\n' +
            '                <div class="col-sm-1">\n' +
            '            <input id="' + name + 'textAlign" class="form-control" name="' + name + 'textAlign" type="text" value=""\n' +
            '            placeholder="ALIGN">\n' +
            '                </div>\n' +
            '                </div>\n' +
            '                <div class="form-group">\n' +
            '            <label class="col-sm-1 control-label">启动事件</label>\n' +
            '            <div class="col-sm-2">\n' +
            '            <input id="' + name + 'packName" class="form-control" name="' + name + 'packName" type="text" value="" placeholder="包名">\n' +
            '            </div>\n' +
            '            <div class="col-sm-2">\n' +
            '            <input id="' + name + 'className" class="form-control" name="' + name + 'className" type="text" value=""\n' +
            '            placeholder="类名">\n' +
            '                </div>\n' +
            '                <div class="col-sm-1">\n' +
            '            <input id="' + name + 'intentFlag" class="form-control" name="' + name + 'intentFlag" type="text" value=""\n' +
            '            placeholder="Intent Flag">\n' +
            '                </div>\n' +
            '                <div class="col-sm-2">\n' +
            '            <input id="' + name + 'action" class="form-control" name="' + name + 'action" type="text" value="" placeholder="ACTION">\n' +
            '            </div>\n' +
            '            <div class="col-sm-2">\n' +
            '            <input id="' + name + 'flyAction" class="form-control" name="' + name + 'flyAction" type="text" value=""\n' +
            '            placeholder="自定义">\n' +
            '                </div>\n' +
            '                </div>\n' +
            '                <div class="form-group">\n' +
            '            <label class="col-sm-1 control-label">备注</label>\n' +
            '            <div class="col-sm-9">\n' +
            '            <textarea class="form-control" name="' + name + 'remark" value="" id="' + name + 'remark"\n' +
            '            placeholder="备注"></textarea>\n' +
            '                </div>\n' +
            '                </div>\n' +
            '                </div>\n' +
            '            </div>');
        $('#myTab').get(0).append(tab.get(0));
        $('#myTabContent').get(0).append(tabContent.get(0));
        $('#myTab a:last').click()
        flyinput1('sub' + subcellnum + '_');
        flyinput2('sub' + subcellnum + '_');
        $('#del' + 'sub' + subcellnum + '_').on("click", function (event) {
            $('#myTab').get(0).removeChild(tab.get(0));
            $('#myTab a:last').click()
            $('#myTabContent').get(0).removeChild(tabContent.get(0));
        });
    }

    function addSub() {
        createTabContent('sub' + subcellnum + '_');
        subcellnum = subcellnum + 1;
    }

</script>

